# Cookie recipe

We arrive on a webpage where we are immediately asked for a username and password to proceed. There is no way to register an account in sight.

We have one potential username, `grandma66`, who left a testimonial on the login page. Trying a trivial combination like grandma66:grandma66 and grandma66:password does not grant us access.

Let's try 'view source' to see if there are any hints lying around.
Here, we find a HTML comment `<!-- We check the password with strcmp, no way anyone is gonna get past that! -->`, and that the form submits to `index.php`. 

Let's have a look at [the PHP documentation for strcmp()](https://www.php.net/manual/en/function.strcmp.php).

On the manual page, it states:

> **Return Values**
> Returns < 0 if str1 is less than str2; > 0 if str1 is greater than str2, and 0 if they are equal.

Given `strcmp` is used to check a password here, it will probably compared with `0` to check if the password is correct.

The top comment on the page states:

> If you rely on strcmp for safe string comparisons, both parameters must be strings, the result is otherwise extremely unpredictable.
> For instance you may get an unexpected 0, or return values of NULL, -2, 2, 3 and -3.  

Indeed, when we check what happens if we compare a string to an array:

> $ php -a
> php > var_dump(strcmp('abc', []));
> PHP Warning:  strcmp() expects parameter 2 to be string, array given in php shell code on line 1
> PHP Stack trace:
> PHP   1. {main}() php shell code:0
> PHP   2. strcmp() php shell code:1
> php shell code:1:
> NULL

An other comment on the same page states:

> Since it may not be obvious to some people, please note that there is another possible return value for this function.
>
> strcmp() will return NULL on failure.
> 
> This has the side effect of equating to a match when using an equals comparison (==).
> Instead, you may wish to test matches using the identical comparison (===), which should not catch a NULL return.

Let's check this:

> php > var_dump(strcmp('abc', []) == 0);
> PHP Warning:  strcmp() expects parameter 2 to be string, array given in php shell code on line 1
> PHP Stack trace:
> PHP   1. {main}() php shell code:0
> PHP   2. strcmp() php shell code:1
> php shell code:1:
> bool(true)

We can guess that the code to check the login works like this:

```php
if(strcmp($password, $_GET['password']) == 0) {
    // Logged in
}
```

However, we still need a way to make `$_GET['password']` something that is not supported by `strcmp`. We can not make it a string, but thanks to [a handy feature of PHP](https://www.php.net/manual/en/faq.html.php#faq.html.arrays), we can make it an array by adding `[]` to the variable.

We send a request to `/index.php?username=grandma66&password[]=abc`, and suddenly access is granted.

After 'logging in', we find a page containing the flag: `Here is the amazing recipe: FLG{328d8ac047ebfca603145ceffcbcd5a2382e8d3b2f80}`
