#!/usr/bin/env python3
import signal
import random


# Source: https://stackoverflow.com/a/22348885
class timeout:
    def __init__(self, seconds=1, error_message='Timeout'):
        self.seconds = seconds
        self.error_message = error_message

    def handle_timeout(self, signum, frame):
        raise TimeoutError(self.error_message)

    def __enter__(self):
        signal.signal(signal.SIGALRM, self.handle_timeout)
        signal.alarm(self.seconds)

    def __exit__(self, type, value, traceback):
        signal.alarm(0)


def random_nums():
    return list(map(int, random.choice(open('solvable-combinations.txt').readlines()).strip().split(' ')))


def numbers_in_input(numbers, input):
    return all(str(x) in input for x in numbers)


print('In this game, you need to combine four numbers using standard mathematical operators ("+", "-", "*", "/", "**") to get 24 as a result.')
print()
print('Example question: [1 1 5 5]')
print('Example solution: -1 + 1 * 5 * 5')

while True:
    with timeout(seconds=60):
        numbers = list(random_nums())
        while True:
            print('Task: %r' % numbers)
            sol = input('Enter solution: ')
            if not numbers_in_input(numbers, sol):
                print("You didn't use all numbers!")
            elif eval(sol) == 24:
                print('Good! Next:')
                break
            else:
                print('Wrong :( Try again.')
